---
description: >
  Iteratively refine an existing writer skill generated by Voiceprint. Add or remove
  forbidden patterns, adjust tone settings, add active patterns, update content templates,
  and keep SKILL.md and voice-profile.md in sync.
user-invocable: false
---

# Voiceprint Refine - Iterative Writer Skill Improvement

Surgically improve an existing writer skill without re-running the full questionnaire. Users discover gaps when using their writer skill in practice - this workflow lets them fix those gaps immediately.

## Inputs

- **Target directory**: The path provided by the user (via `$ARGUMENTS` from the command). This directory must contain both `SKILL.md` and `voice-profile.md`.

## Workflow Overview

```
Phase 1: Load & Validate        (~30s)  → Read files, confirm valid structure, show summary
Phase 2: Understand Intent       (~1 min) → Ask what to change, classify, confirm
Phase 3: Apply Refinements       (~1 min) → Surgical edits to both files
Phase 4: Validate                (~1 min) → Generate test content targeting the change
Phase 5: Summary                 (~30s)  → List changes, offer changelog entry
```

---

## Phase 1: Load & Validate

### Step 1: Read the target files

Read both files from the provided directory path:
- `{TARGET_DIR}/SKILL.md` - The writer skill
- `{TARGET_DIR}/voice-profile.md` - The voice profile

If either file is missing, tell the user:

> I couldn't find a complete writer skill at that path. I need both `SKILL.md` and `voice-profile.md` in the directory. Check the path and try again.

Then stop.

### Step 2: Parse the current profile

Extract and display a quick summary:
- Profile name (from the SKILL.md frontmatter or heading)
- Voice quick reference table (tone, formality, sentence length, etc.)
- Number of forbidden patterns currently listed
- Number of active patterns currently listed
- Content template types present

### Step 3: Confirm with user

Present the summary:

> **Current profile: {PROFILE_NAME}**
>
> {quick reference table}
>
> **Forbidden patterns**: {count} phrases, {count} structures
> **Active patterns**: {count} expressions, {count} structural preferences
> **Content templates**: {list of template types}
>
> What would you like to refine?

---

## Phase 2: Understand Intent

### Step 1: Gather the change request

Use `AskUserQuestion`:
- **Question**: "What would you like to change about your writer skill?"
- **Options**:
  - "Add forbidden patterns" (description: "New phrases or structures to avoid")
  - "Remove forbidden patterns" (description: "Something was flagged that I actually use")
  - "Adjust tone/formality" (description: "Change how formal, casual, direct, etc.")
  - "Add active patterns" (description: "Phrases or structures I want used more")
  - "Update content templates" (description: "Change how specific content types are handled")
  - "Something else" (description: "I'll describe what I need")

### Step 2: Get specifics

Based on their selection, ask a follow-up for details.

**For "Add forbidden patterns":**

Ask (free text, not AskUserQuestion):

> What patterns have you noticed that don't sound like you? Give me examples - specific phrases, sentence structures, or general categories. If you've seen them in content generated with your skill, paste an example.

After they respond, read `references/ai-tells.md` from the voiceprint skill directory to check if the pattern falls into an existing category. If it does, offer to add the full category:

Use `AskUserQuestion`:
- **Question**: "That falls under '{CATEGORY_NAME}' in the AI tells catalog. Want me to add the full category or just the specific phrases you mentioned?"
- **Options**:
  - "Full category" (description: "Block all {COUNT} phrases in this group")
  - "Just what I mentioned" (description: "Only block the specific phrases")

**For "Remove forbidden patterns":**

List the current forbidden patterns from SKILL.md and ask which ones to remove.

**For "Adjust tone/formality":**

Ask (free text):

> How would you describe the adjustment? For example: "more casual", "less hedging", "more direct", "allow more humor". You can also paste an example of writing that has the tone you want.

**For "Add active patterns":**

Ask (free text):

> What patterns or phrases do you want used more? Paste examples from your own writing if you have them.

**For "Update content templates":**

Ask which content template and what to change.

**For "Something else":**

Ask them to describe what they need in free text.

### Step 3: Confirm understanding

Summarize what you're going to change before making edits:

> Here's what I'll do:
>
> {numbered list of specific changes}
>
> Sound right?

Use `AskUserQuestion`:
- **Question**: "Proceed with these changes?"
- **Options**:
  - "Yes, go ahead" (description: "Apply the changes")
  - "Let me adjust" (description: "I want to modify the plan")

If they want to adjust, loop back to gather more detail.

---

## Phase 3: Apply Refinements

Make surgical edits to both `SKILL.md` and `voice-profile.md`. These files have overlapping sections with slightly different names that must stay in sync.

### Section Mapping

The same information appears in both files under different headings:

| SKILL.md Section | voice-profile.md Section |
|---|---|
| Voice Quick Reference | Quick Reference Card |
| Forbidden Patterns → Rejected Phrases | Rejected Phrases / Pattern Rejections |
| Forbidden Patterns → Setup Labels | Setup Labels (if present) |
| Forbidden Patterns → Rejected Structures | Rejected Structures |
| Active Patterns → Natural Expressions | Preferred Patterns / Natural Expressions |
| Active Patterns → Structural Preferences | Structural Preferences |
| Content Templates | Content Templates / Content Type Guidance |
| Red Flags Checklist → Phrase Check | (may not have a direct equivalent) |

### Edit Rules

1. **Always edit both files.** If a pattern is added to SKILL.md's Forbidden Patterns, it must also appear in voice-profile.md's corresponding section.
2. **Preserve existing content.** Add to sections, don't replace them (unless explicitly removing something).
3. **Match the formatting.** Follow the existing bullet/list style in each file.
4. **Update the Red Flags Checklist** in SKILL.md when adding forbidden patterns - add a new checkbox item for the new category.
5. **For new forbidden pattern categories**: Add as a new subsection under Forbidden Patterns in SKILL.md, and add to the rejection list in voice-profile.md.

### Applying Category Expansions

When adding a forbidden pattern category from `ai-tells.md`:

1. Read `references/ai-tells.md` from the voiceprint skill directory
2. Find the matching category
3. Copy all phrases from that category
4. Add them to SKILL.md under Forbidden Patterns as a new subsection (or append to existing)
5. Add them to voice-profile.md's rejection section
6. Add a checkbox item to the Red Flags Checklist in SKILL.md

---

## Phase 4: Validate

### Step 1: Generate test content

Write a short paragraph (3-5 sentences) that specifically targets the change made. The goal is to test whether the skill correctly applies the refinement.

Examples:
- If setup labels were forbidden: Write about a topic that would naturally tempt those patterns, and verify none appear
- If tone was adjusted: Write in the new tone setting
- If active patterns were added: Write content that uses those patterns

### Step 2: Present and verify

> Here's a test paragraph written with the updated skill. I've specifically targeted the area we changed:
>
> {test paragraph}
>
> Does this look right?

Use `AskUserQuestion`:
- **Question**: "How does this look?"
- **Options**:
  - "Good" (description: "The change is working as expected")
  - "Needs more adjustment" (description: "I'll tell you what's still off")

If more adjustment is needed, loop back to Phase 2 Step 2 with the additional feedback.

---

## Phase 5: Summary

### Step 1: List changes

Present a clear summary:

> **Changes applied to {PROFILE_NAME}-writer:**
>
> {numbered list of changes with before/after where relevant}

### Step 2: Offer changelog

Use `AskUserQuestion`:
- **Question**: "Want me to add a changelog entry to your voice profile?"
- **Options**:
  - "Yes" (description: "Append a dated entry to voice-profile.md")
  - "No thanks" (description: "Skip the changelog")

If yes, append to voice-profile.md:

```markdown
---

## Changelog

### {TODAY'S DATE}
- {change description}
```

If a Changelog section already exists, append the new entry under it rather than creating a duplicate section.

### Step 3: Wrap up

> Your writer skill has been updated. The changes will apply next time you (or any AI tool) uses the `{PROFILE_NAME}-writer` skill.

---

## Error Handling

- **Path doesn't exist**: Tell the user the path wasn't found and ask them to check it.
- **Missing files**: Explain which file is missing (`SKILL.md` or `voice-profile.md`) and suggest they may need to run the full `/voiceprint` command first.
- **Unrecognized structure**: If the files exist but don't follow the expected template structure, warn the user and attempt best-effort edits, noting what couldn't be updated automatically.
- **User wants multiple changes**: Handle them sequentially in a single session - loop through Phase 2-4 for each change, then do a single Phase 5 summary at the end.

## References

- `references/ai-tells.md` - AI pattern catalog for category expansion (read from the voiceprint skill directory, not the target writer skill directory)
